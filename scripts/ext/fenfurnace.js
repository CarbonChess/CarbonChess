function FenFurnace(){"use strict";var e={d:(o,t)=>{for(var l in t)e.o(t,l)&&!e.o(o,l)&&Object.defineProperty(o,l,{enumerable:!0,get:t[l]})},o:(e,o)=>Object.prototype.hasOwnProperty.call(e,o),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},o={};function t(e){global.currentFen=e;let o=e.split(" ")[0].split("/");global.currentTurn=e.split(" ")[1],global.castling.w.q=!1,global.castling.w.k=!1,global.castling.b.q=!1,global.castling.b.k=!1;let t=e.split(" ")[2];for(let e in t){let o=t[e]===t[e].toUpperCase()?"w":"b";global.castling[o][t[e].toLowerCase()]=!0}global.enpassantsquare=e.split(" ")[3].toUpperCase(),global.halfMoveCount=e.split(" ")[4],global.moveNumber=e.split(" ")[5],global.boardArray=o.map((e=>e.replace(/[0-9]/g,(e=>"-".repeat(e)))))}function l(e){return String.fromCharCode(e+64)}function r(e){return"b"===e?"w":"b"}function a(){let e="",o=0;for(let t in global.boardArray){let l=global.boardArray[t];for(let t=0;t<l.length;t++)"-"!==l[t]?(o>0&&(e+=o,o=0),e+=l[t]):o++;o>0&&(e+=o),o=0,7!=t&&(e+="/")}e+=" "+global.currentTurn;let t="";return global.castling.w.k&&(t+="K"),global.castling.w.q&&(t+="Q"),global.castling.b.k&&(t+="k"),global.castling.b.q&&(t+="q"),e+=" "+t,e+=" "+global.enpassantsquare,e+=" "+global.halfMoveCount,e+=" "+global.moveNumber,e}function n(e){if(b(e))return g(s(e))?"w":"b";console.warn("Cell",e,"is empty")}function s(e){const o=parseInt(e[0],36)-9,t=8-e[1];return global.boardArray[t][o-1]}function b(e){return"-"!==s(e)}function c(e,o){if(!b(e))return console.log("No Piece Found"),!1;console.log("Moving",e,"->",o),u(s(e),o),i(e)}function u(e,o){console.log("Adding piece",e,"to",o);const t=parseInt(o[0],36)-9,l=8-o[1];let r=global.boardArray[l];global.boardArray[l]=r.substr(0,t-1)+e+r.substr(t)}function i(e){console.log("Deleting piece from",e);const o=parseInt(e[0],36)-9,t=8-e[1];let l=global.boardArray[t];global.boardArray[t]=l.substr(0,o-1)+"-"+l.substr(o)}function g(e){return e===e.toUpperCase()}function p(e,o){return e!==o&&f(e,o)&&!d(e,o)}function f(e,o){let t=s(e),l=t===t.toUpperCase()?"w":"b",a=parseInt(e[1]),c=parseInt(o[1]),u=Math.abs(c-a),i=(e[0],o[0],Math.abs(o.charCodeAt(0)-e.charCodeAt(0)));switch(t.toLowerCase()){case"r":return 0===i||0===u;case"n":return u+i===3&&0!==i&&0!==u;case"k":return i<=1&&u<=1;case"b":return i===u;case"q":return 0===i||0===u||i===u;case"p":const e=1===i&&1===u&&b(o)&&n(o)===r(l),t=1===u||2===u&&[2,7].includes(a),s="w"===l?c>a:c<a,g=o===global.enpassantSquare&&1===i&&1===u;return(e||0===i||g)&&t&&s;default:return!0}}function d(e,o){let t=!1;const l={};let a=s(e),c=n(e),u=parseInt(e[1]),i=parseInt(o[1]),g=Math.abs(i-u),p=e[0],f=o[0],d=Math.abs(o.charCodeAt(0)-e.charCodeAt(0));switch(l.l=f>p?1:f<p?-1:0,l.n=i>u?1:i<u?-1:0,a.toLowerCase()){case"p":return 0===d&&("w"===c?(t=b(e[0]+(u+1)),2!==g||t||(t=b(e[0]+(u+2)))):(t=b(e[0]+(u-1)),2!==g||t||(t=b(e[0]+(u-2))))),t;case"r":case"b":case"q":{let e=!1;for(let o=1;o<=Math.max(d,g);o++){const a=n(String.fromCharCode(parseInt(p.charCodeAt(0))+l.l*o)+(u+l.n*o));(a===c||e)&&(t=!0),a!==r(c)||e||(e=!0)}return t}default:return n(o)===c}}function w(e,o,{isTest:t}={}){const f=s(e);let d=b(o),w=n(e),C=global.boardArray;if(w!=global.currentTurn&&!t)return console.log("Failed to move",e,"->",o),!1;if("k"===f.toLowerCase()&&2===Math.abs(o.charCodeAt(0)-e.charCodeAt(0))){const t=o.charCodeAt(0)-e.charCodeAt(0)>0,l=t?"k":"q";if(!global.castling[w][l])return!1;{const l=t?"H":"A",r="w"===w?"1":"8",a=t?["F","G"]:["B","C","D"];for(let e in a)if(b(a[e]+r))return!1;console.debug("v.134",b(e),b(o),s(e),s(o)),c(e,o),c(l+r,(t?"F":"D")+r),castling[w]={k:!1,q:!1}}}if(!p(e,o))return!1;c(e,o);let h=endcell[1]===("w"===r(w)?"8":"1");if("p"===f&&h){if(!global.promotionPiece)return console.log("NO PROMOTION PIECE FOUND"),global.boardArray=C,!1;i(o),u(global.promotionPiece,o),global.promotionPiece=null}"p"===f&&o===global.enpassantSquare&&(i(global.enpassantSquare),global.halfMoveCount=0);const m=Math.abs(+o[1]-+e[1]);if("p"===f.toLowerCase()&&2===m){const e="w"===w?+o[1]-1:+o[1]+1;global.enpassantSquare=o[0]+e}else global.enpassantSquare;if(function(e){let o={w:"",b:""};for(let e=1;e<=8;e++)for(let t=1;t<=8;t++){const r=l(t)+e;"k"===s(r).toLowerCase()&&(o[n(r)]=r)}for(let r=1;r<=8;r++)for(let a=1;a<=8;a++){const s=l(a)+r;if(!b(s))continue;const c=n(s);if((g(c)&&"b"===e||(t=c)===t.toLowerCase()&&"w"===e)&&p(s,o[e]))return!0}var t;return!1}(global.currentTurn))return global.boardArray=C,!1;if("k"===f)castling[w]={k:!1,q:!1};else if("r"===f){const o="H"===e?"k":"q";castling[w][o]=!1}return"b"===w&&global.moveNumber++,"p"===f.toLowerCase()||d?global.halfMoveCount=0:global.halfMoveCount++,global.currentTurn="w"===global.currentTurn?"b":"w",global.movelist.push(a()),global.movelist.slice(-1)[0]}e.r(o),e.d(o,{isValid:()=>f,makeMove:()=>w,pieceInWay:()=>d,validateMove:()=>p}),Object.assign(global,{castling:{w:{k:!0,q:!0},b:{k:!0,q:!0}},boardArray:[],enpassantSquare:null,moveslist:[],currentTurn:null,halfMoveCount:0,moveNumber:0,promotionPiece:null});const C={setupBoard:function(){t("rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1"),global.movelist=[],global.movelist.push("rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1")},createBoard:t,validation:o,findAllMoves:function(e){let o=[],r=a();for(let a=1;a<=8;a++)for(let n=1;n<=8;n++){const s=l(n)+a;w(e,s,{isTest:!0})&&o.push(s),t(r)}return o}};"undefined"==typeof global&&(global={}),"undefined"!=typeof window&&(window.fenFuncs=C)};