window.FenFurnace=()=>{"use strict";var e={d:(t,o)=>{for(var r in o)e.o(o,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:o[r]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};function o(e){global.currentFen=e;let t=e.split(" ")[0].split("/");global.currentTurn=e.split(" ")[1],global.castling.w.q=!1,global.castling.w.k=!1,global.castling.b.q=!1,global.castling.b.k=!1;let o=e.split(" ")[2];for(let e in o){let t=o[e]===o[e].toUpperCase()?"w":"b";global.castling[t][o[e].toLowerCase()]=!0}global.enpassantsquare=e.split(" ")[3].toUpperCase(),global.halfMoveCount=e.split(" ")[4],global.moveNumber=e.split(" ")[5],global.boardArray=t.map((e=>e.replace(/[0-9]/g,(e=>"-".repeat(e)))))}function r(e){return String.fromCharCode(e+64)}function a(e){return"b"===e?"w":"b"}function l(e){if(s(e))return c(n(e))?"w":"b";console.warn("Cell",e,"is empty")}function n(e){const t=parseInt(e[0],36)-9,o=8-e[1];return global.boardArray[o][t-1]}function s(e){return"-"!==n(e)}function b(e,t){if(!s(e))return console.log("No Piece Found"),!1;console.log("Moving",e,"->",t),function(e,t){console.log("Adding piece",e,"to",t);const o=parseInt(t[0],36)-9,r=8-t[1];let a=global.boardArray[r];global.boardArray[r]=a.substr(0,o-1)+e+a.substr(o)}(n(e),t),u(e)}function u(e){console.log("Deleting piece from",e);const t=parseInt(e[0],36)-9,o=8-e[1];let r=global.boardArray[o];global.boardArray[o]=r.substr(0,t-1)+"-"+r.substr(t)}function c(e){return e===e.toUpperCase()}function i(e,t){return e!==t&&g(e,t)&&!p(e,t)}function g(e,t){let o=n(e),r=o===o.toUpperCase()?"w":"b",b=parseInt(e[1]),u=parseInt(t[1]),c=Math.abs(u-b),i=(e[0],t[0],Math.abs(t.charCodeAt(0)-e.charCodeAt(0)));switch(o.toLowerCase()){case"r":return 0===i||0===c;case"n":return c+i===3&&0!==i&&0!==c;case"k":return i<=1&&c<=1;case"b":return i===c;case"q":return 0===i||0===c||i===c;case"p":const e=1===i&&1===c&&s(t)&&l(t)===a(r),o=1===c||2===c&&[2,7].includes(b),n="w"===r?u>b:u<b,g=t===global.enpassantSquare&&1===i&&1===c;return(e||0===i||g)&&o&&n;default:return!0}}function p(e,t){let o=!1;const r={};let b=n(e),u=l(e),c=parseInt(e[1]),i=parseInt(t[1]),g=Math.abs(i-c),p=e[0],f=t[0],d=Math.abs(t.charCodeAt(0)-e.charCodeAt(0));switch(r.l=f>p?1:f<p?-1:0,r.n=i>c?1:i<c?-1:0,b.toLowerCase()){case"p":return 0===d&&("w"===u?(o=s(e[0]+(c+1)),2!==g||o||(o=s(e[0]+(c+2)))):(o=s(e[0]+(c-1)),2!==g||o||(o=s(e[0]+(c-2))))),o;case"r":case"b":case"q":{let e=!1;for(let t=1;t<=Math.max(d,g);t++){const n=l(String.fromCharCode(parseInt(p.charCodeAt(0))+r.l*t)+(c+r.n*t));(n===u||e)&&(o=!0),n!==a(u)||e||(e=!0)}return o}default:return l(t)===u}}function f(e,t,{isTest:o}={}){const a=n(e);let g=s(t),p=l(e),f=global.boardArray;if(p!=global.currentTurn&&!o)return console.log("Failed to move",e,"->",t),!1;if("k"===a.toLowerCase()&&2===Math.abs(t.charCodeAt(0)-e.charCodeAt(0))){const o=t.charCodeAt(0)-e.charCodeAt(0)>0,r=o?"k":"q";if(!global.castling[p][r])return!1;{const r=o?"H":"A",a="w"===p?"1":"8",l=o?["F","G"]:["B","C","D"];for(let e in l)if(s(l[e]+a))return!1;console.debug("v.134",s(e),s(t),n(e),n(t)),b(e,t),b(r+a,(o?"F":"D")+a),castling[p]={k:!1,q:!1}}}if(!i(e,t))return!1;b(e,t),"p"===a&&t===global.enpassantSquare&&(u(global.enpassantSquare),global.halfMoveCount=0);const d=Math.abs(+t[1]-+e[1]);if("p"===a.toLowerCase()&&2===d){const e="w"===p?+t[1]-1:+t[1]+1;global.enpassantSquare=t[0]+e}else global.enpassantSquare;if(function(e){let t={w:"",b:""};for(let e=1;e<=8;e++)for(let o=1;o<=8;o++){const a=r(o)+e;"k"===n(a).toLowerCase()&&(t[l(a)]=a)}for(let a=1;a<=8;a++)for(let n=1;n<=8;n++){const b=r(n)+a;if(!s(b))continue;const u=l(b);if((c(u)&&"b"===e||(o=u)===o.toLowerCase()&&"w"===e)&&i(b,t[e]))return!0}var o;return!1}(global.currentTurn))return global.boardArray=f,!1;if("k"===a)castling[p]={k:!1,q:!1};else if("r"===a){const t="H"===e?"k":"q";castling[p][t]=!1}return"b"===p&&global.moveNumber++,"p"===a.toLowerCase()||g?global.halfMoveCount=0:global.halfMoveCount++,global.currentTurn="w"===global.currentTurn?"b":"w",global.movelist.push(function(){let e="",t=0;for(let o in global.boardArray){let r=global.boardArray[o];for(let o=0;o<r.length;o++)"-"!==r[o]?(t>0&&(e+=t,t=0),e+=r[o]):t++;t>0&&(e+=t),t=0,7!=o&&(e+="/")}e+=" "+global.currentTurn;let o="";return global.castling.w.k&&(o+="K"),global.castling.w.q&&(o+="Q"),global.castling.b.k&&(o+="k"),global.castling.b.q&&(o+="q"),e+=" "+o,e+=" "+global.enpassantsquare,e+=" "+global.halfMoveCount,e+=" "+global.moveNumber,e}()),global.movelist.slice(-1)[0]}e.r(t),e.d(t,{isValid:()=>g,makeMove:()=>f,pieceInWay:()=>p,validateMove:()=>i}),Object.assign(global,{castling:{w:{k:!0,q:!0},b:{k:!0,q:!0}},currentFen:null,boardArray:[],enpassantSquare:null,moveslist:[],currentTurn:null,halfMoveCount:0,moveNumber:0});const d={setupBoard:function(){o("rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1"),global.movelist=[],global.movelist.push("rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1")},createBoard:o,validation:t};"undefined"!=typeof window&&Object.assign(window,d)});