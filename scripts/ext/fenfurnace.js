function FenFurnace(){"use strict";window.FenFurnaceVersion='0.1.0';var e={d:(t,o)=>{for(var r in o)e.o(o,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:o[r]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};function o(e){global.currentFen=e;let t=e.split(" ")[0].split("/");global.currentTurn=e.split(" ")[1],global.castling.w.q=!1,global.castling.w.k=!1,global.castling.b.q=!1,global.castling.b.k=!1;let o=e.split(" ")[2];for(let e in o){let t=o[e]===o[e].toUpperCase()?"w":"b";global.castling[t][o[e].toLowerCase()]=!0}global.enpassantSquare=e.split(" ")[3].toUpperCase(),global.halfMoveCount=e.split(" ")[4],global.moveNumber=e.split(" ")[5],global.boardArray=t.map((e=>e.replace(/[0-9]/g,(e=>"-".repeat(e)))))}function r(e){return String.fromCharCode(e+64)}function a(e){return"b"===e?"w":"b"}function l(){let e="",t=0;for(let o in global.boardArray){let r=global.boardArray[o];for(let o=0;o<r.length;o++)"-"!==r[o]?(t>0&&(e+=t,t=0),e+=r[o]):t++;t>0&&(e+=t),t=0,7!=o&&(e+="/")}e+=" "+global.currentTurn;let o="";return global.castling.w.k&&(o+="K"),global.castling.w.q&&(o+="Q"),global.castling.b.k&&(o+="k"),global.castling.b.q&&(o+="q"),e+=" "+o,e+=" "+global.enpassantSquare,e+=" "+global.halfMoveCount,e+=" "+global.moveNumber,e}function n(e){if(b(e))return g(s(e))?"w":"b"}function s(e){const t=parseInt(e[0],36)-9,o=8-e[1];return global.boardArray[o][t-1]}function b(e){return"-"!==s(e)}function u(e,t){if(!b(e))return!1;c(s(e),t),i(e)}function c(e,t){const o=parseInt(t[0],36)-9,r=8-t[1];let a=global.boardArray[r];global.boardArray[r]=a.substr(0,o-1)+e+a.substr(o)}function i(e){const t=parseInt(e[0],36)-9,o=8-e[1];let r=global.boardArray[o];global.boardArray[o]=r.substr(0,t-1)+"-"+r.substr(t)}function g(e){return e===e.toUpperCase()}function p(e,t){return e!==t&&f(e,t)&&!d(e,t)}function f(e,t){let o=s(e),r=o===o.toUpperCase()?"w":"b",l=parseInt(e[1]),u=parseInt(t[1]),c=Math.abs(u-l),i=(e[0],t[0],Math.abs(t.charCodeAt(0)-e.charCodeAt(0)));switch(o.toLowerCase()){case"r":return 0===i||0===c;case"n":return c+i===3&&0!==i&&0!==c;case"k":return i<=1&&c<=1;case"b":return i===c;case"q":return 0===i||0===c||i===c;case"p":const e=1===i&&1===c&&b(t)&&n(t)===a(r),o=1===c||2===c&&[2,7].includes(l),s="w"===r?u>l:u<l,g=t===global.enpassantSquare&&1===i&&1===c;return(e||0===i||g)&&o&&s;default:return!0}}function d(e,t){let o=!1;const r={};let l=s(e),u=n(e),c=parseInt(e[1]),i=parseInt(t[1]),g=Math.abs(i-c),p=e[0],f=t[0],d=Math.abs(t.charCodeAt(0)-e.charCodeAt(0));switch(r.l=f>p?1:f<p?-1:0,r.n=i>c?1:i<c?-1:0,l.toLowerCase()){case"p":return 0===d&&("w"===u?(o=b(e[0]+(c+1)),2!==g||o||(o=b(e[0]+(c+2)))):(o=b(e[0]+(c-1)),2!==g||o||(o=b(e[0]+(c-2))))),o;case"r":case"b":case"q":{let e=!1;for(let t=1;t<=Math.max(d,g);t++){const l=n(String.fromCharCode(parseInt(p.charCodeAt(0))+r.l*t)+(c+r.n*t));(l===u||e)&&(o=!0),l!==a(u)||e||(e=!0)}return o}default:return n(t)===u}}function w(e,t,{isTest:o}={}){const f=s(e);let d=b(t),w=n(e),C=global.boardArray;if(w!=global.currentTurn&&!o)return console.log("Failed to move",e,"->",t),!1;if("k"===f.toLowerCase()&&2===Math.abs(t.charCodeAt(0)-e.charCodeAt(0))){const o=t.charCodeAt(0)-e.charCodeAt(0)>0,r=o?"k":"q";if(!global.castling[w][r])return!1;{const r=o?"H":"A",a="w"===w?"1":"8",l=o?["F","G"]:["B","C","D"];for(let e in l)if(b(l[e]+a))return!1;console.debug("v.134",b(e),b(t),s(e),s(t)),u(e,t),u(r+a,(o?"F":"D")+a),castling[w]={k:!1,q:!1}}}if(!p(e,t))return!1;u(e,t);let h=t[1]===("w"===a(w)?"8":"1");if("p"===f&&h){if(!global.promotionPiece)return console.log("NO PROMOTION PIECE FOUND"),global.boardArray=C,!1;i(t),c(global.promotionPiece,t),global.promotionPiece=null}"p"===f&&t===global.enpassantSquare&&(i(global.enpassantSquare),global.halfMoveCount=0);const m=Math.abs(+t[1]-+e[1]);if("p"===f.toLowerCase()&&2===m){const e="w"===w?+t[1]-1:+t[1]+1;global.enpassantSquare=t[0]+e}else global.enpassantSquare;if(function(e){let t={w:"",b:""};for(let e=1;e<=8;e++)for(let o=1;o<=8;o++){const a=r(o)+e;"k"===s(a).toLowerCase()&&(t[n(a)]=a)}for(let a=1;a<=8;a++)for(let l=1;l<=8;l++){const s=r(l)+a;if(!b(s))continue;const u=n(s);if((g(u)&&"b"===e||(o=u)===o.toLowerCase()&&"w"===e)&&p(s,t[e]))return!0}var o;return!1}(global.currentTurn))return global.boardArray=C,!1;if("k"===f)castling[w]={k:!1,q:!1};else if("r"===f){const t="H"===e?"k":"q";castling[w][t]=!1}"b"===w&&global.moveNumber++,"p"===f.toLowerCase()||d?global.halfMoveCount=0:global.halfMoveCount++,global.currentTurn="w"===global.currentTurn?"b":"w";let v=l();return o||global.moveList.push(v),v}e.r(t),e.d(t,{isValid:()=>f,makeMove:()=>w,pieceInWay:()=>d,validateMove:()=>p}),Object.assign(global,{castling:{w:{k:!0,q:!0},b:{k:!0,q:!0}},boardArray:[],enpassantSquare:null,moveList:[],currentTurn:null,halfMoveCount:0,moveNumber:0,promotionPiece:null});const C={setupBoard:function(){o("rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1"),global.moveList=[],global.moveList.push("rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1")},createBoard:o,validation:t,findAllMoves:function(e){let t=[],a=l();for(let l=1;l<=8;l++)for(let n=1;n<=8;n++){const s=r(n)+l;w(e,s,{isTest:!0})&&t.push(s),o(a)}return t}};"undefined"==typeof global&&(global={}),"undefined"!=typeof window&&(window.fenFuncs=C)};